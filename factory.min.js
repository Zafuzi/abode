let node_colors={power:"#fff3a6",oxygen:"#ffa6a6",hydrogen:"#fff",methane:"#a6fffe",water:"#a6caff",steel:"#999",grass:"#a6ffaf",carbon:"#58637a",slag:"#c9bbab",iron:"#ba7254",rocket:"#ff99e6",silicates:"#b6c9a5"},FactoryTypes={solar:{name:"Solar Panels",inputs:{},outputs:{power:{}}},water:{name:"Big Lake of Fresh Water",inputs:{},outputs:{water:{}}},oxygen:{name:"Oxygen Electrolysis Chamber",inputs:{power:{},water:{}},outputs:{hydrogen:{},oxygen:{}}},carbon:{name:"Carbon Mine",inputs:{},outputs:{carbon:{}}},iron:{name:"Iron Mine",inputs:{},outputs:{iron:{},silicates:{}}},steel:{name:"Steel Production Facility",inputs:{iron:{},carbon:{},oxygen:{}},outputs:{steel:{},slag:{}}},rocket:{name:"Rocket Fabricator",inputs:{steel:{},methane:{},oxygen:{},power:{}},outputs:{rocket:{}}}};class Factory{constructor(t,e,n){this.name=t.name,this.inputs=t.inputs,this.outputs=t.outputs,this.x=e,this.y=n,this.w=100;let c=Object.keys(t.inputs).length>Object.keys(t.outputs).length?Object.keys(t.inputs).length:Object.keys(t.outputs).length;this.h=(font_size+25)*c+font_size;let o=ctx.measureText(this.name).width;this.w+=o,factories.push(this)}update(){this.connections=[],this.calc_connections()}draw(){let t=this,e=t.x,n=t.y;ctx.beginPath(),ctx.fillStyle="#223333",ctx.fillRect(e,n,t.w,t.h),ctx.strokeStyle="#444",ctx.strokeRect(e,n,t.w,t.h),ctx.closePath(),e=t.x,n=t.y+45+9+3,Object.keys(t.inputs).forEach(c=>{let o=t.inputs[c];o.x=e,o.y=n,o.name=c,o.parent=t,ctx.beginPath(),ctx.fillStyle=node_colors[o.name],ctx.arc(o.x,o.y,10,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.fillText(o.name,o.x+font_size,o.y+5),ctx.closePath(),n+=25}),e=t.x+t.w,n=t.y+20+3,Object.keys(t.outputs).forEach(c=>{let o=t.outputs[c];o.x=e,o.y=n,o.name=c,o.parent=t,ctx.beginPath(),ctx.fillStyle=node_colors[o.name],ctx.arc(o.x,o.y,10,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.fillText(o.name,o.x-ctx.measureText(o.name).width-font_size,o.y+5),ctx.closePath(),n+=25}),ctx.beginPath(),ctx.fillStyle="#fff",ctx.fillText(t.name,t.x+9,t.y+font_size+9),ctx.closePath()}calc_connections(){let t=this,e=t.x+t.w,n=t.y+20+3;Object.keys(t.outputs).forEach(c=>{let o=t.outputs[c];if(o.x=e,o.y=n,o.name=c,o.parent=t,o.connected){let e=o.connected;if(e.remove_on_mouse_up&&!mousedown)return o.connected=null,void factories.forEach(t=>{Object.keys(t.inputs).forEach(n=>{let c=t.inputs[n];hit_rad({x:c.x,y:c.y,r:10})&&n==e.name&&(c.connected&&(c.connected.connected=null),o.connected=c,c.connected=o)})});if(!e.parent)return;let n={},c=o.x>e.x?e:o;n.remote_node=e,n.parent=t;let s=(o.x+e.x)/2;if(o==c){let t={x:s,y:o.y},c={x:s,y:e.y};n.x=o.x,n.y=o.y,n.cp1=t,n.cp2=c,n.px=e.x,n.py=e.y}else{let t={x:s,y:e.y},c={x:s,y:o.y};n.x=o.x,n.y=o.y,n.cp1=t,n.cp2=c,n.px=e.x,n.py=e.y}n.strokeStyle=node_colors[o.name],t.connections.push(n)}n+=25})}}