let node_colors={power:"#fff3a6",oxygen:"#ffa6a6",hydrogen:"#fff",methane:"#a6fffe",water:"#a6caff",steel:"#999",grass:"#a6ffaf",carbon:"#58637a",slag:"#c9bbab",iron:"#ba7254",rocket:"#ff99e6",silicates:"#b6c9a5"},FactoryTypes={solar:{name:"Solar Panels",inputs:{},outputs:{power:{}}},water:{name:"Big Lake of Fresh Water",inputs:{},outputs:{water:{}}},oxygen:{name:"Oxygen Electrolysis Chamber",inputs:{power:{},water:{}},outputs:{hydrogen:{},oxygen:{}}},carbon:{name:"Carbon Mine",inputs:{},outputs:{carbon:{}}},iron:{name:"Iron Mine",inputs:{},outputs:{iron:{},silicates:{}}},steel:{name:"Steel Production Facility",inputs:{iron:{},carbon:{},oxygen:{}},outputs:{steel:{},slag:{}}},rocket:{name:"Rocket Fabricator",inputs:{steel:{},methane:{},oxygen:{},power:{}},outputs:{rocket:{}}}};class Factory{constructor(t,e,n){this.name=t.name,this.inputs=t.inputs,this.outputs=t.outputs,this.x=e,this.y=n,this.w=100,this.node_radius=5;let o=Object.keys(t.inputs).length>Object.keys(t.outputs).length?Object.keys(t.inputs).length:Object.keys(t.outputs).length;console.log(o),this.h=57+o*(2*this.node_radius+5);let s=ctx.measureText(this.name).width;this.w+=s,factories.push(this)}update(){this.connections=[],this.calc_connections()}draw(){let t=this,e=t.x,n=t.y;ctx.beginPath(),ctx.fillStyle="#223333",ctx.fillRect(e,n,t.w,t.h),ctx.strokeStyle="#444",ctx.strokeRect(e,n,t.w,t.h),ctx.closePath(),e=t.x,n=t.y+45+9+3,Object.keys(t.inputs).forEach(o=>{let s=t.inputs[o];s.x=e,s.y=n,s.name=o,s.parent=t,s.r=t.node_radius,ctx.beginPath(),ctx.fillStyle=node_colors[s.name],ctx.arc(s.x,s.y,t.node_radius,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.fillText(s.name,s.x+font_size,s.y+5),ctx.closePath(),n+=2*t.node_radius+5}),e=t.x+t.w,n=t.y+2*t.node_radius+3,Object.keys(t.outputs).forEach(o=>{let s=t.outputs[o];s.x=e,s.y=n,s.name=o,s.parent=t,s.r=t.node_radius,ctx.beginPath(),ctx.fillStyle=node_colors[s.name],ctx.arc(s.x,s.y,t.node_radius,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.fillText(s.name,s.x-ctx.measureText(s.name).width-2*t.node_radius,s.y+t.node_radius/2),ctx.closePath(),n+=2*t.node_radius+5}),ctx.beginPath(),ctx.fillStyle="#fff",ctx.fillText(t.name,t.x+9,t.y+font_size+9),ctx.closePath()}calc_connections(){let t=this,e=t.x+t.w,n=t.y+2*t.node_radius+3;Object.keys(t.outputs).forEach(o=>{let s=t.outputs[o];if(s.x=e,s.y=n,s.name=o,s.parent=t,s.r=t.node_radius,s.connected){let e=s.connected;if(e.remove_on_mouse_up&&!mousedown)return s.connected=null,void factories.forEach(n=>{Object.keys(n.inputs).forEach(o=>{let c=n.inputs[o];hit_rad({x:c.x,y:c.y,r:t.node_radius})&&o==e.name&&(c.connected&&(c.connected.connected=null),s.connected=c,c.connected=s)})});if(!e.parent)return;let n={},o=s.x>e.x?e:s;n.remote_node=e,n.parent=t;let c=(s.x+e.x)/2;if(s==o){let t={x:c,y:s.y},o={x:c,y:e.y};n.x=s.x,n.y=s.y,n.cp1=t,n.cp2=o,n.px=e.x,n.py=e.y}else{let t={x:c,y:e.y},o={x:c,y:s.y};n.x=s.x,n.y=s.y,n.cp1=t,n.cp2=o,n.px=e.x,n.py=e.y}n.strokeStyle=node_colors[s.name],t.connections.push(n)}n+=2*t.node_radius+5})}}